@model RayaWSoffara.Models.Dashboard
@{
    ViewBag.Title = "Home";
    Layout = "~/Views/Admin/Shared/_AdminLayout.cshtml";
    var firstDayOfMonth = new DateTime(DateTime.UtcNow.ToLocalTime().Year, DateTime.UtcNow.ToLocalTime().Month, 1);
    var lastDayOfMonth = firstDayOfMonth.AddMonths(1).AddDays(-1);
}

<!-- all time statistics -->
<div class="row">
    <!-- users -->
    <div class="col-sm-6 col-md-4">
        <div class="panel panel-dark panel-stat">
            <div class="panel-heading">
                <div class="stat">
                    <div class="row">
                        <a href="/Admin/ReportUsers">
                            <div class="col-xs-4">
                                <img src="/Content/Images/is-user.png" alt="" />
                            </div>
                            <div class="col-xs-8">
                                <small class="stat-label">All Time Registered Users</small>
                                <h1>@Model.AllTimeRegisteredUsers</h1>
                            </div>
                        </a>
                    </div>

                    <div class="mb15"></div>

                    <div class="row">
                        <a href="/Admin/ReportUsers?status=Active">
                            <div class="col-xs-6">
                                <small class="stat-label">Active</small>
                                <h4>@Model.AllTimeActiveUsers</h4>
                            </div>
                        </a>

                        <a href="/Admin/ReportUsers?status=Inactive">
                            <div class="col-xs-6">
                                <small class="stat-label">Pending</small>
                                <h4>@Model.AllTimePendingUsers</h4>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- posts -->
    <div class="col-sm-6 col-md-4">
        <div class="panel panel-dark panel-stat">
            <div class="panel-heading">
                <div class="stat">
                    <div class="row">
                        <a href="/Admin/ReportPosts">
                            <div class="col-xs-4">
                                <img src="/Content/Images/is-user.png" alt="" />
                            </div>
                            <div class="col-xs-8">
                                <small class="stat-label">All Time Posts</small>
                                <h1>@Model.AllTimePosts</h1>
                            </div>
                        </a>
                    </div>

                    <div class="mb15"></div>

                    <div class="row">
                        <a href="/Admin/ReportPosts?status=Active">
                            <div class="col-xs-6">
                                <small class="stat-label">Active</small>
                                <h4>@Model.AllTimeActivePosts</h4>
                            </div>
                        </a>

                        <a href="/Admin/ReportPosts?status=Inactive">
                            <div class="col-xs-6">
                                <small class="stat-label">Pending</small>
                                <h4>@Model.AllTimePendingPosts</h4>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- comments -->
    <div class="col-sm-6 col-md-4">
        <div class="panel panel-dark panel-stat">
            <div class="panel-heading">
                <div class="stat">
                    <div class="row">
                        <a href="/Admin/ReportComments">
                            <div class="col-xs-4">
                                <img src="/Content/Images/is-user.png" alt="" />
                            </div>
                            <div class="col-xs-8">
                                <small class="stat-label">All Time Comments</small>
                                <h1>@Model.AllTimeComments</h1>
                            </div>
                        </a>
                    </div>

                    <div class="mb15"></div>

                    <div class="row">
                        <a href="/Admin/ReportComments?status=Nonreported">
                            <div class="col-xs-6">
                                <small class="stat-label">Non Reported</small>
                                <h4>@Model.AllTimeNonReportedComments</h4>
                            </div>
                        </a>

                        <a href="/Admin/ReportComments?status=Reported">
                            <div class="col-xs-6">
                                <small class="stat-label">Reported</small>
                                <h4>@Model.AllTimeReportedComments</h4>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<!-- all time statistics -->

<!-- users statistics -->
<div class="row">
    <!-- monthly -->
    <div class="col-sm-6 col-md-3 panel-custom-margin">
        <div class="panel panel-success panel-stat">
            <div class="panel-heading">
                <div class="stat">
                    <div class="row">
                        <a href="/Admin/ReportUsers?from=@firstDayOfMonth.ToShortDateString()&to=@lastDayOfMonth.ToShortDateString()">
                            <div class="col-xs-4">
                                <img src="/Content/Images/is-user.png" alt="" />
                            </div>
                            <div class="col-xs-8">
                                <small class="stat-label">Registered Users This Month</small>
                                <h1>@Model.RegisterdUsersThisMonth</h1>
                            </div>
                        </a>
                    </div>

                    <div class="mb15"></div>

                    <div class="row">
                        <a href="/Admin/ReportUsers?from=@firstDayOfMonth.ToShortDateString()&to=@lastDayOfMonth.ToShortDateString()&status=Active">
                            <div class="col-xs-6">
                                <small class="stat-label">Active</small>
                                <h4>@Model.ActivatedUsersThisMonth</h4>
                            </div>
                        </a>

                        <a href="/Admin/ReportUsers?from=@firstDayOfMonth.ToShortDateString()&to=@lastDayOfMonth.ToShortDateString()&status=Inactive">
                            <div class="col-xs-6">
                                <small class="stat-label">Pending</small>
                                <h4>@Model.PendingUsersThisMonth</h4>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- today -->
    <div class="col-sm-6 col-md-3 panel-custom-margin">
        <div class="panel panel-success panel-stat">
            <div class="panel-heading">
                <div class="stat">
                    <div class="row">
                        <a href="/Admin/ReportUsers?from=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&to=@DateTime.UtcNow.ToLocalTime().ToShortDateString()">
                            <div class="col-xs-4">
                                <img src="/Content/Images/is-user.png" alt="" />
                            </div>
                            <div class="col-xs-8">
                                <small class="stat-label">Registered Users Today</small>
                                <h1>@Model.RegisteredUsersToday</h1>
                            </div>
                        </a>
                    </div>

                    <div class="mb15"></div>

                    <div class="row">
                        <a href="/Admin/ReportUsers?from=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&to=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&status=Active">
                            <div class="col-xs-6">
                                <small class="stat-label">Active</small>
                                <h4>@Model.ActivatedUsersToday</h4>
                            </div>
                        </a>

                        <a href="/Admin/ReportUsers?from=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&to=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&status=Inactive">
                            <div class="col-xs-6">
                                <small class="stat-label">Pending</small>
                                <h4>@Model.PendingUsersToday</h4>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- graph -->
    <div class="col-sm-12 col-md-6">
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="row">
                    <div class="pointsgraph">
                        <div>Activated users in tha past 6 months</div>
                        <div id="usersgraph" style="width: 100%; height: 130px"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- users statistics -->

<!-- posts statistics -->
<div class="row">
    <!-- monthly -->
    <div class="col-sm-6 col-md-3 panel-custom-margin">
        <div class="panel panel-danger panel-stat">
            <div class="panel-heading">
                <div class="stat">
                    <div class="row">
                        <a href="/Admin/ReportPosts?from=@firstDayOfMonth.ToShortDateString()&to=@lastDayOfMonth.ToShortDateString()">
                            <div class="col-xs-4">
                                <img src="/Content/Images/is-document.png" alt="" />
                            </div>
                            <div class="col-xs-8">
                                <small class="stat-label">Total Posts This Month</small>
                                <h1>@Model.TotalPostsThisMonth</h1>
                            </div>
                        </a>
                    </div>

                    <div class="mb15"></div>

                    <div class="row">
                        <a href="/Admin/ReportPosts?from=@firstDayOfMonth.ToShortDateString()&to=@lastDayOfMonth.ToShortDateString()&status=Active">
                            <div class="col-xs-6">
                                <small class="stat-label">Active</small>
                                <h4>@Model.ActivatedPostsThisMonth</h4>
                            </div>
                        </a>

                        <a href="/Admin/ReportPosts?from=@firstDayOfMonth.ToShortDateString()&to=@lastDayOfMonth.ToShortDateString()&status=Inactive">
                            <div class="col-xs-6">
                                <small class="stat-label">Pending</small>
                                <h4>@Model.PendingPostsThisMonth</h4>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- today -->
    <div class="col-sm-6 col-md-3 panel-custom-margin">
        <div class="panel panel-danger panel-stat">
            <div class="panel-heading">
                <div class="stat">
                    <div class="row">
                        <a href="/Admin/ReportPosts?from=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&to=@DateTime.UtcNow.ToLocalTime().ToShortDateString()">
                            <div class="col-xs-4">
                                <img src="/Content/Images/is-document.png" alt="" />
                            </div>
                            <div class="col-xs-8">
                                <small class="stat-label">Total Posts Today</small>
                                <h1>@Model.TotalPostsToday</h1>
                            </div>
                        </a>
                    </div>

                    <div class="mb15"></div>

                    <div class="row">
                        <a href="/Admin/ReportPosts?from=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&to=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&status=Active">
                            <div class="col-xs-6">
                                <small class="stat-label">Active</small>
                                <h4>@Model.ActivatedPostsToday</h4>
                            </div>
                        </a>

                        <a href="/Admin/ReportPosts?from=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&to=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&status=Inactive">
                            <div class="col-xs-6">
                                <small class="stat-label">Pending</small>
                                <h4>@Model.PendingPostsToday</h4>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- graph -->
    <div class="col-sm-12 col-md-6">
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="row">
                    <div class="pointsgraph">
                        <div>Activated posts in tha past 6 months</div>
                        <div id="postsgraph" style="width: 100%; height: 130px"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- posts statistics -->

<!-- comments statistics -->
<div class="row">
    <!-- monthly -->
    <div class="col-sm-6 col-md-3 panel-custom-margin">
        <div class="panel panel-primary panel-stat">
            <div class="panel-heading">
                <div class="stat">
                    <div class="row">
                        <a href="/Admin/ReportComments?from=@firstDayOfMonth.ToShortDateString()&to=@lastDayOfMonth.ToShortDateString()">
                            <div class="col-xs-4">
                                <img src="/Content/Images/is-document.png" alt="" />
                            </div>
                            <div class="col-xs-8">
                                <small class="stat-label">Total Comments This Month</small>
                                <h1>@Model.TotalCommentsThisMonth</h1>
                            </div>
                        </a>
                    </div>

                    <div class="mb15"></div>

                    <div class="row">
                        <a href="/Admin/ReportComments?from=@firstDayOfMonth.ToShortDateString()&to=@lastDayOfMonth.ToShortDateString()&status=Nonreported">
                            <div class="col-xs-6">
                                <small class="stat-label">Non Reported</small>
                                <h4>@Model.NonReportedCommentsThisMonth</h4>
                            </div>
                        </a>

                        <a href="/Admin/ReportComments?from=@firstDayOfMonth.ToShortDateString()&to=@lastDayOfMonth.ToShortDateString()&status=Reported">
                            <div class="col-xs-6">
                                <small class="stat-label">Reported</small>
                                <h4>@Model.ReportedCommentsThisMonth</h4>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- today -->
    <div class="col-sm-6 col-md-3 panel-custom-margin">
        <div class="panel panel-primary panel-stat">
            <div class="panel-heading">
                <div class="stat">
                    <div class="row">
                        <a href="/Admin/ReportComments?from=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&to=@DateTime.UtcNow.ToLocalTime().ToShortDateString()">
                            <div class="col-xs-4">
                                <img src="/Content/Images/is-document.png" alt="" />
                            </div>
                            <div class="col-xs-8">
                                <small class="stat-label">Total Comments Today</small>
                                <h1>@Model.TotalCommentsToday</h1>
                            </div>
                        </a>
                    </div>

                    <div class="mb15"></div>

                    <div class="row">
                        <a href="/Admin/ReportComments?from=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&to=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&status=Nonreported">
                            <div class="col-xs-6">
                                <small class="stat-label">Non Reported</small>
                                <h4>@Model.NonreportedCommentsToday</h4>
                            </div>
                        </a>

                        <a href="/Admin/ReportComments?from=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&to=@DateTime.UtcNow.ToLocalTime().ToShortDateString()&status=Reported">
                            <div class="col-xs-6">
                                <small class="stat-label">Reported</small>
                                <h4>@Model.ReportedCommentsToday</h4>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- graph -->
    <div class="col-sm-12 col-md-6">
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="row">
                    <div class="pointsgraph">
                        <div>Non reported comments in tha past 6 months</div>
                        <div id="commentsgraph" style="width: 100%; height: 130px"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- comments statistics -->

<div class="row">

    <div class="col-sm-6">

        <div class="panel panel-default">
            <div class="panel-body">
                <h5 class="subtitle">Top used tags in posts</h5>
                <div id="donut-chart" class="body-chart" style="width: 100%; height: 300px"></div>
            </div>
            <!-- panel-body -->
        </div>
        <!-- panel -->

    </div>
</div>

<script>
    $.ajax({
        url: "/Admin/GetUsersGraphPoints",
        type: 'GET',
        success: function (users) {
            var active = users;
            //var inactive = users[1];
            var dataSet = [
                { label: "Active", data: active, points: { fillColor: "#1CAF9A", size: 5 }, color: '#1CAF9A' }
                //{ label: "Inactive", data: points, points: { fillColor: "#0062FF", size: 5 }, color: '#0062FF' }
            ];

            $.plot($("#usersgraph"), dataSet, {
                xaxis: {
                    mode: "time",
                    tickSize: [1, "month"],
                    timeformat: "%b %Y",
                    tickLength: 0,
                    axisLabel: 'Month',
                    axisLabelUseCanvas: true,
                    axisLabelFontSizePixels: 12,
                    axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',
                    axisLabelPadding: 5
                },
                yaxis: {
                    axisLabel: 'Users',
                    axisLabelUseCanvas: true,
                    axisLabelFontSizePixels: 12,
                    axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',
                    axisLabelPadding: 5
                },
                series: {
                    lines: {
                        show: true,
                        fill: true
                    },
                    points: {
                        radius: 3,
                        show: true,
                        fill: true
                    },
                },
                grid: {
                    borderWidth: 1,
                    hoverable: true
                }
            });

            function showTooltip(x, y, contents, z) {
                $('<div id="flot-tooltip">' + contents + '</div>').css({
                    top: y - 390,
                    left: x - 850,
                    'border-color': z,
                }).appendTo("#usersgraph").fadeIn(200);
            }

            function getMonthName(numericMonth) {
                var monthArray = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                var alphaMonth = monthArray[numericMonth];

                return alphaMonth;
            }

            function convertToDate(timestamp) {
                var newDate = new Date(timestamp);
                var dateString = newDate.getMonth();
                var monthName = getMonthName(dateString);

                return monthName;
            }

            var previousPoint = null;
            $("#usersgraph").bind("plothover", function (event, pos, item) {
                if (item) {
                    if ((previousPoint != item.dataIndex) || (previousLabel != item.series.label)) {
                        previousPoint = item.dataIndex;
                        previousLabel = item.series.label;

                        $("#usersgraph #flot-tooltip").remove();

                        var x = convertToDate(item.datapoint[0]),
                        y = item.datapoint[1];
                        z = item.series.color;

                        showTooltip(item.pageX, item.pageY,
                            "<b>" + item.series.label + "</b><br /> " + x + " = " + y,
                            z);
                    }
                } else {
                    $("#usersgraph #flot-tooltip").remove();
                    previousPoint = null;
                }
            });
        }
    });

    $.ajax({
        url: "/Admin/GetPostsGraphPoints",
        type: 'GET',
        success: function (posts) {
            var active = posts;
            //var inactive = users[1];
            var dataSet = [
                { label: "Active", data: active, points: { fillColor: "#D9534F", size: 5 }, color: '#D9534F' }
                //{ label: "Inactive", data: points, points: { fillColor: "#0062FF", size: 5 }, color: '#0062FF' }
            ];

            $.plot($("#postsgraph"), dataSet, {
                xaxis: {
                    mode: "time",
                    tickSize: [1, "month"],
                    timeformat: "%b %Y",
                    tickLength: 0,
                    axisLabel: 'Month',
                    axisLabelUseCanvas: true,
                    axisLabelFontSizePixels: 12,
                    axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',
                    axisLabelPadding: 5
                },
                yaxis: {
                    axisLabel: 'Posts',
                    axisLabelUseCanvas: true,
                    axisLabelFontSizePixels: 12,
                    axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',
                    axisLabelPadding: 5
                },
                series: {
                    lines: {
                        show: true,
                        fill: true
                    },
                    points: {
                        radius: 3,
                        show: true,
                        fill: true
                    },
                },
                grid: {
                    borderWidth: 1,
                    hoverable: true
                }
            });

            function showTooltip(x, y, contents, z) {
                $('<div id="flot-tooltip">' + contents + '</div>').css({
                    top: y - 610,
                    left: x - 850,
                    'border-color': z,
                }).appendTo("#postsgraph").fadeIn(200);
            }

            function getMonthName(numericMonth) {
                var monthArray = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                var alphaMonth = monthArray[numericMonth];

                return alphaMonth;
            }

            function convertToDate(timestamp) {
                var newDate = new Date(timestamp);
                var dateString = newDate.getMonth();
                var monthName = getMonthName(dateString);

                return monthName;
            }

            var previousPoint = null;
            $("#postsgraph").bind("plothover", function (event, pos, item) {
                if (item) {
                    if ((previousPoint != item.dataIndex) || (previousLabel != item.series.label)) {
                        previousPoint = item.dataIndex;
                        previousLabel = item.series.label;

                        $("#postsgraph #flot-tooltip").remove();

                        var x = convertToDate(item.datapoint[0]),
                        y = item.datapoint[1];
                        z = item.series.color;

                        showTooltip(item.pageX, item.pageY,
                            "<b>" + item.series.label + "</b><br /> " + x + " = " + y,
                            z);
                    }
                } else {
                    $("#postsgraph #flot-tooltip").remove();
                    previousPoint = null;
                }
            });
        }
    });

    $.ajax({
        url: "/Admin/GetCommentsGraphPoints",
        type: 'GET',
        success: function (comments) {
            var active = comments;
            //var inactive = users[1];
            var dataSet = [
                { label: "Non Reported", data: active, points: { fillColor: "#428BCA", size: 5 }, color: '#428BCA' }
                //{ label: "Inactive", data: points, points: { fillColor: "#0062FF", size: 5 }, color: '#0062FF' }
            ];

            $.plot($("#commentsgraph"), dataSet, {
                xaxis: {
                    mode: "time",
                    tickSize: [1, "month"],
                    timeformat: "%b %Y",
                    tickLength: 0,
                    axisLabel: 'Month',
                    axisLabelUseCanvas: true,
                    axisLabelFontSizePixels: 12,
                    axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',
                    axisLabelPadding: 5
                },
                yaxis: {
                    axisLabel: 'Comments',
                    axisLabelUseCanvas: true,
                    axisLabelFontSizePixels: 12,
                    axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',
                    axisLabelPadding: 5
                },
                series: {
                    lines: {
                        show: true,
                        fill: true
                    },
                    points: {
                        radius: 3,
                        show: true,
                        fill: true
                    },
                },
                grid: {
                    borderWidth: 1,
                    hoverable: true
                }
            });

            function showTooltip(x, y, contents, z) {
                $('<div id="flot-tooltip">' + contents + '</div>').css({
                    top: y - 830,
                    left: x - 850,
                    'border-color': z,
                }).appendTo("#commentsgraph").fadeIn(200);
            }

            function getMonthName(numericMonth) {
                var monthArray = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                var alphaMonth = monthArray[numericMonth];

                return alphaMonth;
            }

            function convertToDate(timestamp) {
                var newDate = new Date(timestamp);
                var dateString = newDate.getMonth();
                var monthName = getMonthName(dateString);

                return monthName;
            }

            var previousPoint = null;
            $("#commentsgraph").bind("plothover", function (event, pos, item) {
                if (item) {
                    if ((previousPoint != item.dataIndex) || (previousLabel != item.series.label)) {
                        previousPoint = item.dataIndex;
                        previousLabel = item.series.label;

                        $("#commentsgraph #flot-tooltip").remove();

                        var x = convertToDate(item.datapoint[0]),
                        y = item.datapoint[1];
                        z = item.series.color;

                        showTooltip(item.pageX, item.pageY,
                            "<b>" + item.series.label + "</b><br /> " + x + " = " + y,
                            z);
                    }
                } else {
                    $("#commentsgraph #flot-tooltip").remove();
                    previousPoint = null;
                }
            });
        }
    });

    $.ajax({
        url: "/Admin/GetTopTags",
        type: 'GET',
        success: function (tags) {
            var m6 = new Morris.Donut({
                element: 'donut-chart',
                data: tags,
                colors: ['#D9534F', '#1CAF9A', '#428BCA', '#5BC0DE', '#428BCA']
            });
        }
    });
</script>
